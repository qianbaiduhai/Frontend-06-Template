<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>TicTacToe</title>
        <style>
            div {
                box-sizing: border-box;
            }

            #board {
                width: 300px;
                font-size: 0;
                display: flex;
                flex-wrap: wrap;
            }

            .cell {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 100px;
                height: 100px;
                border: 1px solid #000;
                font-size: 50px;
            }
        </style>
    </head>
    <body>
        <div id="board"></div>
        <script>
            window.onload = () => {
                const $ = (props) => document.querySelector(props);
                const clone = (obj) => JSON.parse(JSON.stringify(obj));

                console.log('script init...');
                const boardELement = $('#board');
                console.log('Successfully get the default board！', boardELement);

                const initData = [
                    [0, 0, 0],
                    [0, 0, 0],
                    [0, 0, 0],
                ];

                // 1:o，2:x
                let flag = 1;
                let data = clone(initData);

                const changeFlag = () => {
                    flag = 3 - flag;
                };

                const resetBoard = () => {
                    flag = 1;
                    data = clone(initData);
                    renderCell(boardELement, data);
                };

                const checkStatus = () => {
                    for (let i = 0; i < 3; i++) {
                        let win = true;
                        for (let j = 0; j < 3; j++) {
                            if (data[i][j] !== flag) {
                                win = false;
                                break;
                            }
                        }
                        if (win) {
                            return true;
                        }
                    }

                    for (let i = 0; i < 3; i++) {
                        let win = true;
                        for (let j = 0; j < 3; j++) {
                            if (data[j][i] !== flag) {
                                win = false;
                                break;
                            }
                        }
                        if (win) {
                            return true;
                        }
                    }

                    {
                        let win = true;
                        for (let j = 0; j < 3; j++) {
                            if (data[j][j] !== flag) {
                                win = false;
                                break;
                            }
                        }
                        if (win) {
                            return true;
                        }
                    }
                    {
                        let win = true;
                        for (let j = 0; j < 3; j++) {
                            if (data[j][3 - j - 1] !== flag) {
                                win = false;
                                break;
                            }
                        }
                        if (win) {
                            return true;
                        }
                    }
                    return false;
                };
                const showWinner = () => {
                    window.alert(`${renderChess(flag)}, win`);
                    resetBoard();
                };
                const aiMove = () => {};
                const bestChoice = () => {
                    const cloneData = clone(data);
                };
                const userMove = (i, j) => {
                    if (data[i][j]) {
                        console.warn("Can't repeat play chess!");
                        return;
                    }
                    data[i][j] = flag;
                    renderCell(boardELement, data);
                    if (checkStatus()) {
                        showWinner();
                        return;
                    }
                    changeFlag();
                };
                const renderChess = (ele) => (ele === 1 ? 'o' : ele === 2 ? 'x' : '');
                const renderCell = (container) => {
                    container.innerHTML = '';
                    const fragment = document.createDocumentFragment();

                    for (let i = 0; i < data.length; i++) {
                        for (let j = 0; j < data[i].length; j++) {
                            const element = data[i][j];
                            let cell = document.createElement('div');
                            cell.innerText = renderChess(element);
                            cell.setAttribute('class', 'cell');
                            cell.addEventListener('click', () => userMove(i, j));
                            fragment.appendChild(cell);
                        }
                    }

                    container.appendChild(fragment);
                };

                console.time('renderCell');
                renderCell(boardELement, data);
                console.timeEnd('renderCell');
            };
        </script>
    </body>
</html>
